<?xml version="1.0" encoding="UTF-8"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.ehcache.org/v3"
        xsi:schemaLocation="http://www.ehcache.org/v3 
                            http://www.ehcache.org/schema/ehcache-core-3.0.xsd">

    <!-- 
    EhCache configuration for Hibernate second-level cache
    Optimized for SMM Panel application performance requirements
    -->

    <!-- Default cache template for entities -->
    <cache-template name="defaultEntityCache">
        <key-type>java.lang.Object</key-type>
        <value-type>java.lang.Object</value-type>
        <expiry>
            <ttl unit="minutes">30</ttl>
        </expiry>
        <resources>
            <heap unit="entries">1000</heap>
            <offheap unit="MB">10</offheap>
        </resources>
        <statistics>true</statistics>
    </cache-template>

    <!-- Template for frequently accessed, rarely changed data -->
    <cache-template name="staticDataCache">
        <key-type>java.lang.Object</key-type>
        <value-type>java.lang.Object</value-type>
        <expiry>
            <ttl unit="hours">2</ttl>
        </expiry>
        <resources>
            <heap unit="entries">2000</heap>
            <offheap unit="MB">20</offheap>
        </resources>
        <statistics>true</statistics>
    </cache-template>

    <!-- Template for query result caching -->
    <cache-template name="queryCache">
        <key-type>java.lang.Object</key-type>
        <value-type>java.lang.Object</value-type>
        <expiry>
            <ttl unit="minutes">10</ttl>
        </expiry>
        <resources>
            <heap unit="entries">500</heap>
            <offheap unit="MB">5</offheap>
        </resources>
        <statistics>true</statistics>
    </cache-template>

    <!-- =================================== -->
    <!-- ENTITY-SPECIFIC CACHE CONFIGURATIONS -->
    <!-- =================================== -->

    <!-- Service entities - frequently read, rarely changed -->
    <cache alias="com.smmpanel.entity.Service" uses-template="staticDataCache">
        <expiry>
            <ttl unit="hours">4</ttl>
        </expiry>
        <resources>
            <heap unit="entries">500</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <!-- Service collections -->
    <cache alias="com.smmpanel.entity.Service.orders" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">15</ttl>
        </expiry>
        <resources>
            <heap unit="entries">100</heap>
            <offheap unit="MB">2</offheap>
        </resources>
    </cache>

    <!-- User entities - moderate caching -->
    <cache alias="com.smmpanel.entity.User" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">20</ttl>
        </expiry>
        <resources>
            <heap unit="entries">2000</heap>
            <offheap unit="MB">15</offheap>
        </resources>
    </cache>

    <!-- User collections - shorter cache for dynamic data -->
    <cache alias="com.smmpanel.entity.User.orders" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">5</ttl>
        </expiry>
        <resources>
            <heap unit="entries">500</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <cache alias="com.smmpanel.entity.User.balanceTransactions" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">10</ttl>
        </expiry>
        <resources>
            <heap unit="entries">300</heap>
            <offheap unit="MB">3</offheap>
        </resources>
    </cache>

    <!-- ConversionCoefficient - static data, long cache -->
    <cache alias="com.smmpanel.entity.ConversionCoefficient" uses-template="staticDataCache">
        <expiry>
            <ttl unit="hours">6</ttl>
        </expiry>
        <resources>
            <heap unit="entries">100</heap>
            <offheap unit="MB">1</offheap>
        </resources>
    </cache>

    <!-- Order entities - frequently accessed, moderate volatility -->
    <cache alias="com.smmpanel.entity.Order" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">10</ttl>
        </expiry>
        <resources>
            <heap unit="entries">5000</heap>
            <offheap unit="MB">50</offheap>
        </resources>
    </cache>

    <!-- Order collections -->
    <cache alias="com.smmpanel.entity.Order.binomCampaigns" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">15</ttl>
        </expiry>
        <resources>
            <heap unit="entries">1000</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <!-- BinomCampaign entities -->
    <cache alias="com.smmpanel.entity.BinomCampaign" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">20</ttl>
        </expiry>
        <resources>
            <heap unit="entries">2000</heap>
            <offheap unit="MB">10</offheap>
        </resources>
    </cache>

    <!-- VideoProcessing entities -->
    <cache alias="com.smmpanel.entity.VideoProcessing" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">5</ttl>
        </expiry>
        <resources>
            <heap unit="entries">1000</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <!-- BalanceTransaction entities - shorter cache due to frequent updates -->
    <cache alias="com.smmpanel.entity.BalanceTransaction" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">5</ttl>
        </expiry>
        <resources>
            <heap unit="entries">3000</heap>
            <offheap unit="MB">15</offheap>
        </resources>
    </cache>

    <!-- BalanceDeposit entities -->
    <cache alias="com.smmpanel.entity.BalanceDeposit" uses-template="defaultEntityCache">
        <expiry>
            <ttl unit="minutes">15</ttl>
        </expiry>
        <resources>
            <heap unit="entries">1000</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <!-- =================================== -->
    <!-- QUERY CACHE CONFIGURATIONS -->
    <!-- =================================== -->

    <!-- Default query results cache -->
    <cache alias="default-query-results-region" uses-template="queryCache">
        <resources>
            <heap unit="entries">1000</heap>
            <offheap unit="MB">10</offheap>
        </resources>
    </cache>

    <!-- Hibernate's standard query cache -->
    <cache alias="org.hibernate.cache.spi.QueryResultsRegion" uses-template="queryCache">
        <resources>
            <heap unit="entries">1000</heap>
            <offheap unit="MB">10</offheap>
        </resources>
    </cache>

    <!-- Update timestamps cache for query cache invalidation -->
    <cache alias="default-update-timestamps-region" uses-template="queryCache">
        <expiry>
            <none/>
        </expiry>
        <resources>
            <heap unit="entries">5000</heap>
        </resources>
    </cache>

    <!-- Custom query caches for specific use cases -->
    <cache alias="service-statistics-cache" uses-template="queryCache">
        <expiry>
            <ttl unit="hours">1</ttl>
        </expiry>
        <resources>
            <heap unit="entries">100</heap>
            <offheap unit="MB">2</offheap>
        </resources>
    </cache>

    <cache alias="user-statistics-cache" uses-template="queryCache">
        <expiry>
            <ttl unit="minutes">30</ttl>
        </expiry>
        <resources>
            <heap unit="entries">500</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <cache alias="order-statistics-cache" uses-template="queryCache">
        <expiry>
            <ttl unit="minutes">15</ttl>
        </expiry>
        <resources>
            <heap unit="entries">200</heap>
            <offheap unit="MB">3</offheap>
        </resources>
    </cache>

    <!-- =================================== -->
    <!-- DISK STORE CONFIGURATION -->
    <!-- =================================== -->
    <persistence directory="#{java.io.tmpdir}/ehcache-smm-panel"/>

</config>