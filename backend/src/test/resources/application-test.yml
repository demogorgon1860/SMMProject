---
spring:
  # Main application config
  application:
    name: smm-panel-test

  # Datasource configuration
  datasource:
    url: >-
      jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=PostgreSQL
    driver-class-name: org.h2.Driver
    username: sa
    password:

    hikari:
      driver-class-name: org.h2.Driver
      maximum-pool-size: 5
      minimum-idle: 2
      connection-timeout: 5000

  # Liquibase configuration
  liquibase:
    enabled: false  # Disable Liquibase for tests, use JPA DDL instead

  # JPA configuration
  jpa:
    hibernate:
      ddl-auto: create-drop
    # CRITICAL: Enable SQL logging for performance testing
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        format_sql: true
        use_sql_comments: true
        generate_statistics: true
        # Enable detailed query logging
        show_sql: true
        type:
          descriptor:
            sql:
              BasicBinder: TRACE
        # Batch configuration for testing
        jdbc:
          batch_size: 25
          batch_versioned_data: true
          fetch_size: 50
        order_inserts: true
        order_updates: true
        default_batch_fetch_size: 16
        max_fetch_depth: 3
        enable_lazy_load_no_trans: false
        connection:
          provider_disables_autocommit: true
    open-in-view: false

  # H2 console
  h2:
    console:
      enabled: true
      path: /h2-console

  # Redis configuration (using embedded for tests)
  redis:
    host: localhost
    port: 6379
    timeout: 2000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: -1ms

  # Kafka configuration (using embedded for tests)
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: smm-panel-test
      auto-offset-reset: earliest
      key-deserializer: >-
        org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: >-
        org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*"
    producer:
      key-serializer: >-
        org.apache.kafka.common.serialization.StringSerializer
      value-serializer: >-
        org.springframework.kafka.support.serializer.JsonSerializer
      acks: 1
      retries: 0

  # Task execution
  task:
    execution:
      pool:
        core-size: 2
        max-size: 5
    scheduling:
      pool:
        size: 2

  # Profile-specific configurations
  config:
    activate:
      on-profile: integration-test

  testcontainers:
    reuse:
      enable: true

# Logging configuration for query performance testing
logging:
  level:
    root: INFO
    com.smmpanel: DEBUG
    org.springframework: INFO
    # CRITICAL: Enable comprehensive SQL logging
    org.hibernate: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.hibernate.stat: DEBUG
    org.springframework.orm.jpa: DEBUG
    org.springframework.transaction: DEBUG
    # Custom query performance logging
    com.smmpanel.test.performance: DEBUG
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level [%logger{20}] - %msg%n"

# Application-specific configurations
app:
  # Performance monitoring configuration
  monitoring:
    enabled: true
    query-count:
      enabled: true
      warn-threshold: 3
      error-threshold: 5
      
  # Test-specific performance thresholds
  performance:
    max-queries:
      order-creation: 3
      order-listing: 2
      single-order-fetch: 1
      transaction-history: 2
      balance-check: 1
      service-listing: 1
      user-profile: 1
      bulk-operations: 5

  # JWT configuration
  jwt:
    secret: test-secret-key-for-unit-tests-only
    expiration-ms: 3600000
    refresh-expiration-ms: 7200000
    issuer: smmpanel-test

  # Currency configuration
  currency:
    default: USD
    exchange-rate-api:
      url: https://api.exchangerate.host/latest
      base-currency: USD
      cache-duration: 3600
      timeout-ms: 5000

  # Exchange rate configuration
  exchange-rate:
    api-url: https://api.exchangerate.host/latest
    base-currency: USD
    cache-duration: 3600
    api-timeout-ms: 5000

  # Fraud detection
  fraud-detection:
    enabled: true
    rate-limit-per-minute: 10
    max-orders-per-hour: 100
    high-value-threshold: 50.0

  # Order processing
  order:
    processing:
      async-enabled: false  # Disable async for tests
      max-retries: 3
      retry-delay-ms: 1000
      batch-size: 10
      thread-pool-size: 2

    sla:
      monitoring:
        enabled: false  # Disable for tests
        interval-ms: 60000

    fraud:
      detection:
        enabled: true
        rate-limit:
          enabled: true
          requests-per-minute: 30

  # Perfect Panel API
  perfectpanel:
    api:
      compatibility-mode: true
      response-format: legacy

  # External APIs (mocked for tests)
  binom:
    api-url: http://localhost:8081/api/v1
    api-key: test-key
    timeout: 5000

  youtube:
    api-key: test-youtube-key
    api-url: https://www.googleapis.com/youtube/v3

  cryptomus:
    api-url: https://api.cryptomus.com/v1
    merchant-id: test-merchant
    api-key: test-api-key

  # Features
  features:
    clip-creation: true
    auto-refill: false
    bulk-operations: true

# Management endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always
